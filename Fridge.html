<html>
  <body>
    <head>
      <h1>This is a fridge</h1>

      <div id="page">
        <div id="fridge">
          <div id="top">
            <div id="topgrid">
              <div id="topcontainers">
                <div class="topcontainer">
                  <div class="toptext"></div>
                  <button class="toptakebutton">Take</button>
                </div>
                <div class="topcontainer">
                  <div class="toptext"></div>
                  <button class="toptakebutton">Take</button>
                </div>
                <div class="topcontainer">
                  <div class="toptext"></div>
                  <button class="toptakebutton">Take</button>
                </div>
                <div class="topcontainer">
                  <div class="toptext"></div>
                  <button class="toptakebutton">Take</button>
                </div>
                <div class="topcontainer">
                  <div class="toptext"></div>
                  <button class="toptakebutton">Take</button>
                </div>
                <div class="topcontainer">
                  <div class="toptext"></div>
                  <button class="toptakebutton">Take</button>
                </div>
              </div>
            </div>
            <div id="tophandle"></div>

            <div id="opened_top"></div>
          </div>

          <div id="bottom">
            <div id="bottomgrid">
              <div id="bottomcontainers">
                <div class="bottomcontainer">
                  <div class="bottomtext"></div>
                  <button class="bottomtakebutton">Take</button>
                </div>
                <div class="bottomcontainer">
                  <div class="bottomtext"></div>
                  <button class="bottomtakebutton">Take</button>
                </div>
                <div class="bottomcontainer">
                  <div class="bottomtext"></div>
                  <button class="bottomtakebutton">Take</button>
                </div>
                <div class="bottomcontainer">
                  <div class="bottomtext"></div>
                  <button class="bottomtakebutton">Take</button>
                </div>
              </div>
            </div>

            <div id="bottomhandle"></div>

            <div id="opened_bottom"></div>
          </div>
        </div>

        <div>
          <input id="input" style="margin-left: 200px" />
          <button id="enter">Enter</button>

          <div id="controller">
            <div id="threeinarow">
              <div>Foodlist</div>
              <select id="food_list">
                <option value=""></option>
                <option value="egg">egg</option>
                <option value="tofu">tofu</option>
                <option value="pork">pork</option>
                <option value="iceCream">iceCream</option>
                <option value="tomato">tomato</option>
                <option value="potato">potato</option>
                <option value="pepper">pepper</option>
                <option value="onion">onion</option>
                <option value="beef">beef</option>
                <option value="cilantro">cilantro</option>
                <option value="fish">fish</option>
                <option value="eggplant">eggplant</option>
              </select>
              <div>Number</div>
              <div>
                <input id="quantity" />
              </div>

              <div>
                <button id="addbutton">Add</button>
              </div>
            </div>
            <div style="display: flex">
              <div>Take#</div>
              <input id="takeinput" />
            </div>
            <div id="menu">
              <div class="menuitem">
                <div class="dish">Fried tomato egg</div>
                <button class="cookbutton">Cook</button>
                <div class="recipe">
                  <img src="./pic/fried _tomatoegg .jpg" class="recipepic" />
                  <div class="recipeitem">
                    <div class="itemname">egg</div>
                    <div class="itemcount">3</div>
                  </div>
                  <div class="recipeitem">
                    <div class="itemname">tomato</div>
                    <div class="itemcount">1</div>
                  </div>
                </div>
              </div>

              <div class="menuitem">
                <div class="dish">Fried tofu fish</div>
                <button class="cookbutton">Cook</button>
                <div class="recipe">
                  <img src="pic/fried_tofufish.jpg" class="recipepic" />
                  <div class="recipeitem">
                    <div class="itemname">tofu</div>
                    <div class="itemcount">1</div>
                  </div>
                  <div class="recipeitem">
                    <div class="itemname">fish</div>
                    <div class="itemcount">1</div>
                  </div>
                </div>
              </div>

              <div class="menuitem">
                <div class="dish">Fried cilantro beef</div>
                <button class="cookbutton">Cook</button>
                <div class="recipe">
                  <img src="./pic/fried_cilantrobeef.jpeg" class="recipepic" />
                  <div class="recipeitem">
                    <div class="itemname">beef</div>
                    <div class="itemcount">300</div>
                  </div>
                  <div class="recipeitem">
                    <div class="itemname">cilantro</div>
                    <div class="itemcount">50</div>
                  </div>
                </div>
              </div>

              <div class="menuitem">
                <div class="dish">Fried pepper pork</div>
                <button class="cookbutton">Cook</button>
                <div class="recipe">
                  <img src="pic/fried _pepperpork.jpg" class="recipepic" />
                  <div class="recipeitem">
                    <div class="itemname">pork</div>
                    <div class="itemcount">250</div>
                  </div>
                  <div class="recipeitem">
                    <div class="itemname">pepper</div>
                    <div class="itemcount">3</div>
                  </div>
                </div>
              </div>

              <div class="menuitem">
                <div class="dish">three brothers</div>
                <button class="cookbutton">Cook</button>
                <div class="recipe">
                  <img src="pic/fried _threebrothers.jpg" class="recipepic" />
                  <div class="recipeitem">
                    <div class="itemname">potato</div>
                    <div class="itemcount">1</div>
                  </div>
                  <div class="recipeitem">
                    <div class="itemname">pepper</div>
                    <div class="itemcount">2</div>
                  </div>
                  <div class="recipeitem">
                    <div class="itemname">eggplant</div>
                    <div class="itemcount">1</div>
                  </div>
                </div>
              </div>

              <div class="menuitem">
                <div class="dish">onion beef</div>
                <button class="cookbutton">Cook</button>
                <div class="recipe">
                  <img src="pic/fried_onionbeef.jpg" class="recipepic" />
                  <div class="recipeitem">
                    <div class="itemname">onion</div>
                    <div class="itemcount">1</div>
                  </div>
                  <div class="recipeitem">
                    <div class="itemname">beef</div>
                    <div class="itemcount">300</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div id="selectedoption"></div>
        </div>
      </div>
    </head>
  </body>
</html>

<style>
  #page {
    display: flex;
    flex-direction: row;
    justify-content: flex-start;
  }
  #fridge {
    position: relative;
    width: 300px;
    height: 600px;
    padding: 5px;
    border: 3px solid grey;
  }

  #top {
    position: relative;
    width: 100%;
    height: 350px;
    border-radius: 5px;
    border: 1px solid green;
    margin-bottom: 10px;
  }

  #topgrid {
    position: absolute;
    height: 100%;
    width: 100%;
    display: none;
  }
  #topcontainers {
    display: grid;
    grid-template-columns: auto auto auto;
    gap: 5px;
  }
  .topcontainer {
    border: 1px solid rgb(4, 93, 20);
    border-radius: 3px;
    height: 80%;
    width: 70%;
    padding: 10px;
  }
  #tophandle {
    position: absolute;
    width: 8%;
    height: 50%;
    border-radius: 5px;
    border: 1px solid green;
    top: 25%;
    left: 5%;
    cursor: pointer;
  }

  #opened_top {
    position: absolute;
    left: 310px;
    top: 0;
    width: 60px;
    height: 350px;
    border: 1px solid green;
    display: none;
    cursor: pointer;
  }

  #bottom {
    position: relative;
    width: 100%;
    height: 235px;
    border-radius: 5px;
    border: 1px solid blueviolet;
  }

  #bottomgrid {
    position: absolute;
    height: 100%;
    width: 100%;
    display: none;
  }
  #bottomcontainers {
    display: grid;
    grid-template-columns: auto auto;
    gap: 5px;
  }

  .bottomcontainer {
    border: 1px solid blueviolet;
    border-radius: 3px;
    height: 80%;
    width: 70%;
    padding: 10px;
  }
  #opened_bottom {
    position: absolute;
    left: 310px;

    width: 60px;
    height: 240px;
    border: 1px solid blueviolet;
    display: none;
    cursor: pointer;
  }

  #bottomhandle {
    position: absolute;
    width: 8%;
    height: 50%;
    border-radius: 5px;
    border: 1px solid blueviolet;
    top: 25%;
    left: 5%;
    cursor: pointer;
  }
  #controller {
    width: 350px;
    height: 650px;
    margin-left: 200px;
    border: 1px solid black;
    border-radius: 6px;
  }
  #food_list {
    position: relative;
    height: 20px;
    margin-top: 1px;
  }

  #quantity {
    position: relative;
    height: 20px;
    width: 30px;
  }

  #addbutton {
    position: relative;
  }

  #threeinarow {
    display: flex;

    justify-content: space-between;
    flex-direction: row;
    gap: 12px;
  }
  .toptakebutton {
    display: none;
  }
  .bottomtakebutton {
    display: none;
  }

  .recipepic {
    width: 150px;
    height: 110px;
  }
  .recipeitem {
    display: flex;
    gap: 8px;
  }

  #menu {
    display: grid;
    grid-template-columns: auto auto;
  }

  .dish {
    padding-top: 20px;
    display: inline-block;
  }
  .cookbutton {
    padding: 2px;
    display: inline-block;
  }
</style>

<script>
  let inventory = {};
  const tophandle = document.getElementById('tophandle');
  const opened_top = document.getElementById('opened_top');
  const bottomhandle = document.getElementById('bottomhandle');
  const opened_bottom = document.getElementById('opened_bottom');

  const input = document.getElementById('input');
  const enter = document.getElementById('enter');
  const food_list = document.getElementById('food_list');
  const quantity = document.getElementById('quantity');
  const addbutton = document.getElementById('addbutton');
  const topgrid = document.getElementById('topgrid');
  const bottomgrid = document.getElementById('bottomgrid');
  const selectedoption = document.getElementById('selectedoption');
  const topcontainers = document.getElementsByClassName('topcontainer');
  const bottomcontainers = document.getElementsByClassName('bottomcontainer');
  const toptext = document.getElementsByClassName('toptext');
  const bottomtext = document.getElementsByClassName('bottomtext');
  const toptakebutton = document.getElementsByClassName('toptakebutton');
  const bottomtakebutton = document.getElementsByClassName('bottomtakebutton');
  const takeinput = document.getElementById('takeinput');

  const cookbutton = document.getElementsByClassName('cookbutton');
  const menuitem = document.getElementsByClassName('menuitem');
  const recipeitem = document.getElementsByClassName('recipeitem');
  const recipe = document.getElementsByClassName('recipe');

  const unitmap = {
    egg: '',
    tofu: 'box',
    milk: 'ml',
    juice: 'jar',
    pork: 'g',
    iceCream: 'cup',
    tomato: '',
    potato: '',
    pepper: '',
    onion: '',
    cilantro: 'g',
    beef: 'g',
    fish: '',
    eggplant: '',
  };
  const locationmap = {
    egg: 'top',
    tofu: 'top',
    milk: 'top',
    juice: 'top',
    pork: 'bottom',
    iceCream: 'bottom',
    tomato: 'top',
    potato: 'top',
    pepper: 'top',
    onion: 'top',
    cilantro: 'top',
    beef: 'bottom',
    fish: 'bottom',
    eggplant: 'top',
  };

  tophandle.onclick = function () {
    tophandle.style.display = 'none';
    opened_top.style.display = 'block';
    topgrid.style.display = 'grid';
  };

  bottomhandle.onclick = function () {
    bottomhandle.style.display = 'none';
    opened_bottom.style.display = 'block';
    bottomgrid.style.display = 'grid';
  };

  opened_top.onclick = function () {
    tophandle.style.display = 'block';
    opened_top.style.display = 'none';
    topgrid.style.display = 'none';
  };
  opened_bottom.onclick = function () {
    bottomhandle.style.display = 'block';
    opened_bottom.style.display = 'none';
    bottomgrid.style.display = 'none';
  };

  enter.onclick = function () {
    let option = document.createElement('option');
    food_list.appendChild(option);
    option.innerText = input.value;
    input.value = ' ';
  };

  addbutton.onclick = function () {
    let num = Number(quantity.value);
    if (isNaN(Number(quantity.value))) {
      alert('Need to enter a number');
    } else if (locationmap[food_list.value] === 'top') {
      for (let i = 0; i < topcontainers.length; i++) {
        if (toptext[i].innerText === '') {
          toptext[i].innerText =
            num + ' ' + unitmap[food_list.value] + ' ' + food_list.value;
          toptakebutton[i].style.display = 'block';
          toptakebutton[i].onclick = function () {
            let temp = toptext[i].innerText.split(' ');
            if (Number(temp[0]) < Number(takeinput.value)) {
              alert('Not enough to take');
            } else if (Number(temp[0]) === Number(takeinput.value)) {
              toptakebutton[i].style.display = 'none';
              toptext[i].innerText = '';
            } else {
              if (temp.length === 3) {
                toptext[i].innerText =
                  Number(temp[0]) -
                  takeinput.value +
                  ' ' +
                  temp[1] +
                  ' ' +
                  temp[2];
              } else {
                toptext[i].innerText =
                  Number(temp[0]) - takeinput.value + ' ' + temp[1];
              }
            }
          };
          break;
        }
        if (toptext[i].innerText.includes(food_list.value)) {
          let a = toptext[i].innerText.split(' ')[0];

          toptext[i].innerText =
            Number(a) +
            num +
            ' ' +
            unitmap[food_list.value] +
            ' ' +
            food_list.value;

          break;
        }
      }
    } else if (locationmap[food_list.value] === 'bottom') {
      for (let i = 0; i < bottomcontainers.length; i++) {
        if (bottomtext[i].innerText === '') {
          bottomtext[i].innerText =
            num + ' ' + unitmap[food_list.value] + ' ' + food_list.value;
          bottomtakebutton[i].style.display = 'block';
          bottomtakebutton[i].onclick = function () {
            let temp = bottomtext[i].innerText.split(' ');
            if (Number(temp[0]) < Number(takeinput.value)) {
              alert('Not enough to take');
            } else if (Number(temp[0]) === Number(takeinput.value)) {
              bottomtakebutton[i].style.display = 'none';
              bottomtext[i].innerText = '';
            } else {
              temp[0] = Number(temp[0]) - takeinput.value;
              bottomtext[i].innerText = temp.join(' ');
              // bottomtext[i].innerText =
              //   Number(temp[0]) -
              //   takeinput.value +
              //   ' ' +
              //   temp[1] +
              //   ' ' +
              //   temp[2];
            }
          };
          break;
        } else if (bottomtext[i].innerText.includes(food_list.value)) {
          let a = toptext[i].innerText.split(' ')[0];

          bottomtext[i].innerText =
            Number(a) +
            num +
            ' ' +
            unitmap[food_list.value] +
            ' ' +
            food_list.value;

          break;
        }
      }
    }
    food_list.value = '';
    quantity.value = '';
  };

  function checkText(text) {
    for (let i = 0; i < text.length; i++) {
      let a = text[i].innerText.split(' ');
      let name = a[a.length - 1];
      if (!!name) {
        inventory[name] = {
          count: Number(a[0]),
          location: locationmap[name],
          unit: a.length === 3 ? a[1] : '',
        };
      }
    }
  }

  //get current fridge's inventory
  function getInventory() {
    checkText(toptext);
    checkText(bottomtext);
  }

  function clearFridge() {
    for (let i = 0; i < toptext.length; i++) {
      toptext[i].innerHTML = '';
      toptakebutton[i].style.display = 'none';
    }
    for (let i = 0; i < bottomtext.length; i++) {
      bottomtext[i].innerHTML = '';
      bottomtakebutton[i].style.display = 'none';
    }
  }

  function updateInventory() {
    clearFridge();
    let items = Object.keys(inventory);
    let a = 0;
    let b = 0;

    for (let i = 0; i < items.length; i++) {
      //when items are used up
      if (inventory[items[i]].location === 'top') {
        let temptop =
          inventory[items[i]].unit === ''
            ? [inventory[items[i]].count, items[i]]
            : [inventory[items[i]].count, inventory[items[i]].unit, items[i]];
        toptext[a].innerText = temptop.join(' ');
        toptakebutton[a].style.display = 'block';
        a++;
      } else {
        let tempbottom =
          inventory[items[i]].unit === ''
            ? [inventory[items[i]].count, items[i]]
            : [inventory[items[i]].count, inventory[items[i]].unit, items[i]];
        bottomtext[b].innerText = tempbottom.join(' ');
        bottomtakebutton[b].style.display = 'block';
        b++;
      }
    }
  }

  for (let i = 0; i < cookbutton.length; i++) {
    cookbutton[i].onclick = function () {
      const recipeitems = recipe[i].getElementsByClassName('recipeitem');
      let obj = {};
      for (let j = 0; j < recipeitems.length; j++) {
        obj[recipeitems[j].children[0].innerText] = Number(
          recipeitems[j].children[1].innerText
        );
      }
      // we should check fridge inventory now
      getInventory();
      // now we should compare recipe's item with inventory
      let canCook = true;
      let keys = Object.keys(obj);
      for (let j = 0; j < keys.length; j++) {
        let item = keys[j];
        if (!inventory[item]) {
          alert(`不好意思，冰箱里没有${item}`);
          canCook = false;
        } else if (inventory[item].count < obj[item]) {
          alert(`亲，还需要${obj[item] - inventory[item].count}个${item}哦～`);
          canCook = false;
        }
      }
      // after check all recipe ingredient and all good, then we could substract
      if (canCook) {
        for (let j = 0; j < keys.length; j++) {
          let item = keys[j];
          inventory[item].count = inventory[item].count - obj[item];
          if (inventory[item].count === 0) {
            delete inventory[item];
          }
        }
        updateInventory();
      }
    };
  }
</script>
